class Component{id;className;style;styleClass;dataAttributes;ariaAttributes;children=[];buildAttributes(){let attrs={};if(this.id)attrs.id=this.id;let classNames=[];if(this.className)classNames.push(this.className);if(this.styleClass)classNames.push(this.styleClass.generatedClassName);if(classNames.length>0)attrs.class=classNames.join(" ");if(this.style)attrs.style=Object.entries(this.style).map(([k,v])=>`${k}: ${v}`).join("; ");if(this.dataAttributes)for(let[key,value]of Object.entries(this.dataAttributes))attrs[`data-${key}`]=value;if(this.ariaAttributes)for(let[key,value]of Object.entries(this.ariaAttributes))attrs[`aria-${key}`]=value;return attrs}}class Reconciler{eventListeners=[];reconcile(parentElement,oldNode,newNode,index=0){let currentElement=parentElement.childNodes[index];if(!oldNode&&newNode){let newElement=this.createDomElement(newNode);parentElement.appendChild(newElement);return}if(!newNode){if(currentElement)this.cleanupEventListeners(currentElement),parentElement.removeChild(currentElement);return}if(!oldNode||!newNode)return;if(this.isDifferentNodeType(oldNode,newNode)){let newElement=this.createDomElement(newNode);if(currentElement)this.cleanupEventListeners(currentElement),parentElement.replaceChild(newElement,currentElement);else parentElement.appendChild(newElement);return}if(currentElement){if(newNode.tag==="#text"){if(oldNode.textContent!==newNode.textContent)currentElement.textContent=newNode.textContent||"";return}if(currentElement instanceof HTMLElement)this.updateAttributes(currentElement,oldNode.attributes,newNode.attributes),this.updateEventListeners(currentElement,oldNode.events,newNode.events),this.reconcileChildren(currentElement,oldNode.children,newNode.children)}}isDifferentNodeType(oldNode,newNode){return oldNode.tag!==newNode.tag}createDomElement(node){if(node.tag==="#text")return document.createTextNode(node.textContent||"");let element=document.createElement(node.tag);for(let[key,value]of Object.entries(node.attributes))if(value!==void 0&&value!==null)element.setAttribute(key,String(value));this.attachEventListeners(element,node.events);for(let child of node.children)element.appendChild(this.createDomElement(child));return element}updateAttributes(element,oldAttrs,newAttrs){for(let key of Object.keys(oldAttrs))if(!(key in newAttrs))element.removeAttribute(key);for(let[key,value]of Object.entries(newAttrs)){let oldValue=oldAttrs[key];if(value!==oldValue)if(value!==void 0&&value!==null)element.setAttribute(key,String(value));else element.removeAttribute(key)}}attachEventListeners(element,events){for(let[eventName,handler]of Object.entries(events)){if(!handler)continue;let wrappedHandler=(e)=>{if(eventName==="change"||eventName==="input"){let target=e.target;handler(target.value)}else if(eventName==="click")handler();else handler(e)};element.addEventListener(eventName,wrappedHandler),this.eventListeners.push({element,eventName,handler:wrappedHandler})}}updateEventListeners(element,oldEvents,newEvents){for(let eventName of Object.keys(oldEvents))if(!(eventName in newEvents)){let listener=this.eventListeners.find((l)=>l.element===element&&l.eventName===eventName);if(listener)element.removeEventListener(eventName,listener.handler),this.eventListeners=this.eventListeners.filter((l)=>l!==listener)}for(let[eventName,handler]of Object.entries(newEvents)){let oldHandler=oldEvents[eventName];if(handler!==oldHandler){let oldListener=this.eventListeners.find((l)=>l.element===element&&l.eventName===eventName);if(oldListener)element.removeEventListener(eventName,oldListener.handler),this.eventListeners=this.eventListeners.filter((l)=>l!==oldListener);if(handler){let wrappedHandler=(e)=>{if(eventName==="change"||eventName==="input"){let target=e.target;handler(target.value)}else if(eventName==="click")handler();else handler(e)};element.addEventListener(eventName,wrappedHandler),this.eventListeners.push({element,eventName,handler:wrappedHandler})}}}}reconcileChildren(parentElement,oldChildren,newChildren){let maxLength=Math.max(oldChildren.length,newChildren.length);for(let i=0;i<maxLength;i++){let oldChild=oldChildren[i]||null,newChild=newChildren[i]||null;if(!newChild&&oldChild){let childElement=parentElement.childNodes[i];if(childElement)this.cleanupEventListeners(childElement),parentElement.removeChild(childElement)}else if(newChild)this.reconcile(parentElement,oldChild,newChild,i)}}cleanupEventListeners(node){if(node instanceof HTMLElement){this.eventListeners=this.eventListeners.filter((listener)=>{if(listener.element===node)return node.removeEventListener(listener.eventName,listener.handler),!1;return!0});for(let i=0;i<node.childNodes.length;i++)this.cleanupEventListeners(node.childNodes[i])}}dispose(){for(let listener of this.eventListeners)listener.element.removeEventListener(listener.eventName,listener.handler);this.eventListeners=[]}getEventListenerCount(){return this.eventListeners.length}}var globalReconciler=null;function getReconciler(){if(!globalReconciler)globalReconciler=new Reconciler;return globalReconciler}function resetReconciler(){if(globalReconciler)globalReconciler.dispose();globalReconciler=null}class RenderManager{previousVirtualDom=null;container=null;mount(node,container){this.container=container,this.previousVirtualDom=node;let dom=getReconciler().createDomElement(node);container.appendChild(dom)}update(newNode){if(!this.container)throw Error("Cannot update before mounting");let reconciler=getReconciler();if(this.previousVirtualDom)reconciler.reconcile(this.container,this.previousVirtualDom,newNode,0);else{let dom=reconciler.createDomElement(newNode);this.container.appendChild(dom)}this.previousVirtualDom=newNode}unmount(){if(this.container){let reconciler=getReconciler();while(this.container.firstChild)reconciler.reconcile(this.container,this.previousVirtualDom,null,0);this.previousVirtualDom=null,this.container=null}}getContainer(){return this.container}}var ServiceLifetime;((ServiceLifetime2)=>{ServiceLifetime2.Transient="transient";ServiceLifetime2.Singleton="singleton";ServiceLifetime2.Scoped="scoped"})(ServiceLifetime||={});class ServiceProvider{services=new Map;scopedInstances=new Map;parent=null;constructor(parent){this.parent=parent||null}registerSingleton(key,factory){return this.services.set(key,{factory,lifetime:"singleton"}),this}registerTransient(key,factory){return this.services.set(key,{factory,lifetime:"transient"}),this}registerScoped(key,factory){return this.services.set(key,{factory,lifetime:"scoped"}),this}registerInstance(key,instance){return this.services.set(key,{factory:()=>instance,lifetime:"singleton",instance}),this}getService(key){let descriptor=this.services.get(key);if(descriptor)return this.resolveService(key,descriptor);if(this.parent)return this.parent.getService(key);return}getRequiredService(key){let service=this.getService(key);if(service===void 0){let keyName=typeof key==="string"?key:key.name||"Unknown";throw Error(`Required service not found: ${keyName}`)}return service}hasService(key){return this.services.has(key)||(this.parent?.hasService(key)??!1)}createScope(){return new ServiceProvider(this)}dispose(){for(let instance of this.scopedInstances.values())if(instance&&typeof instance.dispose==="function")instance.dispose();this.scopedInstances.clear()}resolveService(key,descriptor){switch(descriptor.lifetime){case"singleton":if(!descriptor.instance)descriptor.instance=descriptor.factory();return descriptor.instance;case"scoped":if(!this.scopedInstances.has(key))this.scopedInstances.set(key,descriptor.factory());return this.scopedInstances.get(key);case"transient":default:return descriptor.factory()}}getRegisteredServices(){let keys=Array.from(this.services.keys());if(this.parent)keys.push(...this.parent.getRegisteredServices());return Array.from(new Set(keys))}}var rootServiceProvider=null;function getRootServiceProvider(){if(!rootServiceProvider)rootServiceProvider=new ServiceProvider;return rootServiceProvider}function configureServices(configure){let services=getRootServiceProvider();configure(services)}function resetServiceProvider(){if(rootServiceProvider)rootServiceProvider.dispose();rootServiceProvider=null}class ServiceCollectionBuilder{provider=new ServiceProvider;singleton(key,factory){return this.provider.registerSingleton(key,factory),this}transient(key,factory){return this.provider.registerTransient(key,factory),this}scoped(key,factory){return this.provider.registerScoped(key,factory),this}instance(key,instance){return this.provider.registerInstance(key,instance),this}build(){return this.provider}}class StatelessComponent extends Component{serviceProvider=getRootServiceProvider();render(){let context={getService:(key)=>this.serviceProvider.getService(key),serviceProvider:this.serviceProvider};return this.build(context).render()}}class StatefulComponent extends Component{_state=null;_mounted=!1;_renderScheduled=!1;_renderManager=new RenderManager;serviceProvider=getRootServiceProvider();get state(){if(!this._state){if(typeof this.createState!=="function")throw Error(`Component ${this.constructor.name} does not implement createState()`);if(this._state=this.createState(),!this._state)throw Error(`createState() returned null/undefined for ${this.constructor.name}`);if(typeof this._state.setComponent==="function")this._state.setComponent(this);else if(console.warn(`State object for ${this.constructor.name} missing setComponent method.`,this._state),typeof this._state._setComponent==="function")this._state._setComponent(this);this._state.onInit()}return this._state}render(){let context={getService:(key)=>this.serviceProvider.getService(key),serviceProvider:this.serviceProvider};return this.state._context=context,this.state.build(context).render()}mount(container){let node=this.render();this._renderManager.mount(node,container),this._mounted=!0,this.state.onMount()}_scheduleRender(){if(this._renderScheduled)return;this._renderScheduled=!0,requestAnimationFrame(()=>{if(this._renderScheduled=!1,this._mounted){let node=this.render();this._renderManager.update(node),this.state.onUpdate()}})}unmount(){if(this._mounted&&this._state)this._state.onDispose(),this._renderManager.unmount(),this._mounted=!1}}class ComponentState{_component=null;_context=null;_needsRender=!1;get component(){if(!this._component)throw Error("State not initialized");return this._component}setComponent(component){this._component=component}setState(fn){fn(),this._needsRender=!0,this.component._scheduleRender()}onInit(){}onMount(){}onUpdate(){}onDispose(){}}class ServerActionsClient{baseUrl;constructor(baseUrl="/api/_equantic/actions"){this.baseUrl=baseUrl}async invoke(actionId,args=[]){let data=await(await fetch(this.baseUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({actionId,arguments:args})})).json();if(!data.success)throw Error(data.error||`Server action failed: ${actionId}`);return data.result}}var globalServerActionsClient=null;function getServerActionsClient(){if(!globalServerActionsClient)globalServerActionsClient=new ServerActionsClient;return globalServerActionsClient}function configureServerActions(baseUrl){globalServerActionsClient=new ServerActionsClient(baseUrl)}function resetServerActionsClient(){globalServerActionsClient=null}class Container extends Component{render(){return{tag:"div",attributes:this.buildAttributes(),events:{},children:this.children.map((c)=>c.render())}}}class Flex extends Component{direction="row";justify;align;gap;wrap=!1;render(){let attrs=this.buildAttributes(),styles=["display: flex",`flex-direction: ${this.direction}`];if(this.justify)styles.push(`justify-content: ${this.justify}`);if(this.align)styles.push(`align-items: ${this.align}`);if(this.gap)styles.push(`gap: ${this.gap}`);if(this.wrap)styles.push("flex-wrap: wrap");let existingStyle=attrs.style||"";return attrs.style=existingStyle?`${existingStyle}; ${styles.join("; ")}`:styles.join("; "),{tag:"div",attributes:attrs,events:{},children:this.children.map((c)=>c.render())}}}class Column extends Flex{constructor(){super();this.direction="column"}}class Row extends Flex{constructor(){super();this.direction="row"}}class Text extends Component{content="";paragraph=!1;constructor(content){super();if(content)this.content=content}render(){return{tag:this.paragraph?"p":"span",attributes:this.buildAttributes(),events:{},children:[{tag:"#text",attributes:{},events:{},children:[],textContent:this.content}]}}}class Heading extends Component{content="";level=1;constructor(content,level=1){super();if(content)this.content=content;this.level=Math.min(6,Math.max(1,level))}render(){return{tag:`h${this.level}`,attributes:this.buildAttributes(),events:{},children:[{tag:"#text",attributes:{},events:{},children:[],textContent:this.content}]}}}class Button extends Component{type="button";disabled=!1;text;onClick;render(){let attrs=this.buildAttributes();if(attrs.type=this.type,this.disabled)attrs.disabled="true";let events={};if(this.onClick)events.click=this.onClick;let children=this.children.length>0?this.children.map((c)=>c.render()):this.text?[{tag:"#text",attributes:{},events:{},children:[],textContent:this.text}]:[];return{tag:"button",attributes:attrs,events,children}}}class TextInput extends Component{type="text";value="";placeholder;disabled=!1;readOnly=!1;name;onChange;onInput;render(){let attrs=this.buildAttributes();if(attrs.type=this.type,attrs.value=this.value,this.placeholder)attrs.placeholder=this.placeholder;if(this.disabled)attrs.disabled="true";if(this.readOnly)attrs.readonly="true";if(this.name)attrs.name=this.name;let events={};if(this.onChange)events.change=this.onChange;if(this.onInput)events.input=this.onInput;return{tag:"input",attributes:attrs,events,children:[]}}}class Link extends Component{href="#";target;text;render(){let attrs=this.buildAttributes();if(attrs.href=this.href,this.target)attrs.target=this.target;if(this.target==="_blank")attrs.rel="noopener noreferrer";let children=this.children.length>0?this.children.map((c)=>c.render()):this.text?[{tag:"#text",attributes:{},events:{},children:[],textContent:this.text}]:[];return{tag:"a",attributes:attrs,events:{},children}}}class Checkbox extends Component{checked=!1;disabled=!1;name;onChange;render(){let attrs=this.buildAttributes();if(attrs.type="checkbox",this.checked)attrs.checked="true";if(this.disabled)attrs.disabled="true";if(this.name)attrs.name=this.name;let events={};if(this.onChange)events.change=(e)=>{let target=e.target;this.onChange(target.checked)};return{tag:"input",attributes:attrs,events,children:[]}}}function mount(component,selector){let container=document.querySelector(selector);if(!container)throw Error(`Container not found: ${selector}`);component.mount(container)}function createApp(ComponentClass,selector){let component=new ComponentClass;return mount(component,selector),component}async function boot(){console.log("eQuantic.UI Runtime (v2.1) initializing...");try{let config=window.__EQ_CONFIG||{},pageName=resolvePageName(config);if(!pageName){handleNoPage();return}await loadAndMountPage(pageName,config.version)}catch(err){handleGlobalError(err)}}function resolvePageName(config){if(config.page)return config.page;return new URLSearchParams(window.location.search).get("page")}async function loadAndMountPage(pageName,version){let root=document.getElementById("app");if(!root)throw Error("Root element #app not found");root.innerHTML='<div class="loading">Loading resource...</div>';try{let cacheBuster=version?`?v=${version}`:"",modulePath=`/_equantic/${pageName}.js${cacheBuster}`;console.log(`eQuantic.UI: Loading module '${modulePath}'...`);let ComponentClass=(await import(modulePath))[pageName];if(!ComponentClass)throw Error(`Module ${pageName} does not export class '${pageName}'`);console.log(`eQuantic.UI: Mounting ${pageName}...`);let app=new ComponentClass;if(typeof app.mount==="function")root.innerHTML="",app.mount(root);else if(typeof app.render==="function")root.innerHTML="",app.render(root);else console.warn("Component missing mount/render method",app),root.innerHTML=`
                <div style="padding: 2rem; color: #166534; background: #dcfce7; border-radius: 8px;">
                    <h1 style="margin:0">âœ… Loaded ${pageName}</h1>
                    <p>Instance created but no <code>mount()</code> method found.</p>
                </div>
            `}catch(e){if(e.message?.includes("Failed to fetch")||e.message?.includes("Cannot find module"))render404(root,pageName);else throw e}}function handleNoPage(){if(window.location.pathname==="/"||window.location.pathname==="")renderWelcome(document.getElementById("app"));else render404(document.getElementById("app"),window.location.pathname)}function handleGlobalError(error){console.error("Runtime Error:",error);let root=document.getElementById("app");if(root)root.innerHTML=`
            <div style="color: #991b1b; padding: 20px; text-align: center; font-family: system-ui;">
                <h3>Application Error</h3>
                <pre style="background: #fef2f2; padding: 10px; border-radius: 4px; display: inline-block; text-align: left;">${error.message}</pre>
            </div>
        `}function render404(root,resource){root.innerHTML=`
        <div style='display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; font-family: system-ui, sans-serif; text-align: center;'>
            <h1 style='font-size: 6rem; margin: 0; color: #cbd5e1;'>404</h1>
            <h2 style='font-size: 2rem; margin: 1rem 0; color: #1e293b;'>Page Not Found</h2>
            <p style='color: #64748b; font-size: 1.2rem;'>The resource '<strong>${escapeHtml(resource)}</strong>' does not exist.</p>
            <a href='/' style='margin-top: 2rem; padding: 0.75rem 1.5rem; background: #2563eb; color: white; text-decoration: none; border-radius: 0.5rem; font-weight: 500;'>Go Home</a>
        </div>
    `}function renderWelcome(root){root.innerHTML=`
        <div style='text-align:center; padding: 2rem; font-family: sans-serif; height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center;'>
            <h1 style="color: #2563eb; font-size: 2.5rem;">Welcome to eQuantic.UI</h1>
            <p style="color: #64748b;">No default page configured.</p>
        </div>
    `}function escapeHtml(unsafe){return unsafe.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}boot();export{resetServiceProvider,resetServerActionsClient,resetReconciler,mount,getServerActionsClient,getRootServiceProvider,getReconciler,createApp,configureServices,configureServerActions,boot,TextInput,Text,StatelessComponent,StatefulComponent,ServiceProvider,ServiceLifetime,ServiceCollectionBuilder,ServerActionsClient,Row,RenderManager,Reconciler,Link,Heading,Flex,Container,ComponentState,Component,Column,Checkbox,Button};
